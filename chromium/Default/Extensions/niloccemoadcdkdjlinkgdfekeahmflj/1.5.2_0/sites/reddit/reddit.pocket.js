(function(){if(isSafari()&&window.top!=window)return;var e="http://www.reddit.com/";$("head").append("<style>.pkt_added {text-decoration:none !important;}</style>");var t={};t.buttons=[{text:"pocket",successText:"saved to pocket",container:"div.entry ul.flat-list",className:"pocket-reddit-button",selector:".pocket-reddit-button",data:function(t){var n=$(t).closest(".entry").find("a.title");if(n===undefined||n.length===0)n=$(t).closest(".entry").find(".first a");var r=$(n).text().trim(),s=$(n).attr("href").trim();return s=i(s,e),{text:r,url:s}}}];var n=function(e){var t=document.createElement("a");t.setAttribute("class",e.className),t.setAttribute("href","#"),$(t).text(e.text);var n=document.createElement("li");return n.appendChild(t),n},r=function(){var e,i=t.buttons.length;for(e=0;e<i;e++){var s=t.buttons[e];$(s.container).each(function(){var e=$(this);if($(e).hasClass("pocket-inserted"))return;var t=$(e).parent().children(".morecomments");if(t.length!==0){var i=t.children("a");i.click(function(){setTimeout(function(){r()},1e3)});return}$(e).addClass("pocket-inserted");var o=n(s);$(e).append(o);var u=s.data;$(o).click(function(t){var n=u(o),r={id:"reddit",action:"addURL",url:n.url,title:n.title};sendMessage(r,function(e){e.status==="success"&&($(o).replaceWith($('<li><a class="'+s.className+' pkt_added">'+s.successText+"</a></li>")),document.body.style.cursor="default"),window.thePKT_BM.handleMessageResponse(e)}),t.preventDefault()})})}},i=function(t,n){if(/^https?:/.test(t))return t;var r=document,i=r.getElementsByTagName("base")[0],s=i&&i.href,o=r.head||r.getElementsByTagName("head")[0],u=i||o.appendChild(r.createElement("base")),a=r.createElement("a"),f;return u.href=n,a.href=t,f=a.href,i?i.href=s:o.removeChild(u),f};(function s(){sendMessage({action:"getSetting",key:"reddit"},function(e){e.value==="true"||e.value===!0?r():setTimeout(s,2e3)})})()})();