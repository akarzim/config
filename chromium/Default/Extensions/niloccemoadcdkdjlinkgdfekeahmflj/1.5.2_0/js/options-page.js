(function(){function t(){var t=document.getElementById("username-field"),n=document.getElementById("logout-link-wrapper"),r=document.getElementById("login-link-wrapper");sendMessage({action:"getSetting",key:"username"},function(i){var s=i.value;s?(t.innerHTML=s,n.style.display="inline",t.style.display="inline",r.style.display="none"):(t.style.display="none",n.style.display="none",r.style.display="inline"),$.each(e,function(e,t){var n="#"+t+"-checkbox";sendMessage({action:"getSetting",key:t},function(e){$(n).prop("checked",boolFromString(e.value))})}),sendMessage({action:"getSetting",key:"keyboard-shortcut-add"},function(e){var t=e.value;t!==undefined&&$("#keyboard-shortcut-text").val(t),o()})})}function n(e){return e.length>0&&e.match(/^(((alt|shift|ctrl|command|⌘|⌥|⌃|⇧)\+)+([a-z0-9]{1}\+)*([a-z0-9]{1}))$/gi)===null?!1:!0}function r(){$.each(e,function(e,t){var n="#"+t+"-checkbox";$(n).click(function(){sendMessage({action:"setSetting",key:t,value:stringFromBool($(this).is(":checked"))})})})}function i(){isMac()?$("#ril-topics-links-win").hide():$("#ril-topics-links-mac").hide();var e;isSafari()?e="?s=SAFARI_EXT_OPTIONS":e="?s=CHROME_EXT_OPTIONS";var t=[{selector:".ril-web a",link:"http://getpocket.com/a"+e},{selector:".ril-iphone-ipad a",link:"http://getpocket.com/ios"+e},{selector:".ril-mac a",link:"http://getpocket.com/mac"+e},{selector:".ril-android a",link:"http://getpocket.com/android"+e},{selector:".ril-iphone a",link:"http://getpocket.com/iphone"+e},{selector:".ril-ipad a",link:"http://getpocket.com/android"+e}];$.each(t,function(e,t){$(t.selector).attr("href",t.link)})}function s(){(function(){$("#logout-link").click(function(){sendMessage({action:"logout"},function(e){t()})}),$("#login-link").click(function(){sendMessage({action:"showLoginWindow"})}),$("#search-support-link").click(function(e){var t="http://help.getpocket.com";sendMessage({action:"openTab",url:t}),e.preventDefault()}),$("#send-us-an-email-link").click(function(e){var t=isChrome()?"http://help.getpocket.com/customer/portal/emails/new?email%5Bsubject%5D=Question+about+Pocket+Extension+for+Chrome":"http://help.getpocket.com/customer/portal/emails/new?email%5Bsubject%5D=Question+about+Pocket+Extension+for+Safari";sendMessage({action:"openTab",url:t}),e.preventDefault()}),$("#get-in-touch-on-twitter-link").click(function(e){var t=isChrome()?"%23chrome ":"%23safari ",n="https://twitter.com/intent/tweet?screen_name=pocketsupport&text="+t;sendMessage({action:"openTab",url:n}),e.preventDefault()})})(),function(){function r(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}var i=isMac()?"⌘+⇧+P":"ctrl+shift+S";$("#keyboard-shortcut-text").attr("placeholder",i);var s={16:!1,18:!1,17:!1,91:!1},o="all",u=isMac()?"⇧":"shift",a=isMac()?"⌥":"alt",f=isMac()?"⌃":"ctrl",l=isMac()?"⌘":"command",c={16:u,18:a,17:f,91:l},h={8:"backspace",9:"tab",12:"clear",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",36:"home",35:"end",33:"pageup",34:"pagedown",188:",",190:".",191:"/",192:"`",189:"-",187:"=",186:";",222:"'",219:"[",221:"]",220:"\\"},p=[];$("#keyboard-shortcut-text").keydown(function(e){var t=e.keyCode;if(t===8)$(this).val("");else if(t===13||t===27)$(this).blur();else{var n=c[t]||h[t]||String.fromCharCode(t).toUpperCase();r(p,n)==-1&&(p.push(n),$(this).val(p.join("+")))}e.preventDefault()}),$("#keyboard-shortcut-text").keyup(function(e){p=[]}),$("#keyboard-shortcut-text").focus(function(e){this.select(),this.onmouseup=function(){return this.onmouseup=null,!1},$(".shortcut-info").text("Record a new shortcut")}),$("#keyboard-shortcut-text").focusout(function(e){$(this).removeClass("error");var r=$(this).val().trim().replace(/[\s\,\&]/gi,"+").replace(/[^A-Z0-9⇧⌥⌃⌘\+]/gi,"");$(this).val(r);var i,s;r===""?(i="keyboard-shortcut-add",s=$("#keyboard-shortcut-text").attr("placeholder"),sendMessage({action:"setSetting",key:i,value:s})):n(r)?(i="keyboard-shortcut-add",s=r,sendMessage({action:"setSetting",key:i,value:s})):$(this).addClass("error"),t()})}(),r(),i(),t(),u()}function o(){var e=$("#keyboard-shortcut-text").attr("placeholder"),n=$("#keyboard-shortcut-text").val();if(e===n)$(".shortcut-info").text("");else{var r=$("<a href='#''>Reset to default</a>");r.click(function(n){$("#keyboard-shortcut-text").removeClass("error"),sendMessage({action:"setSetting",key:"keyboard-shortcut-add",value:e}),t(),$(".shortcut-info").text(""),document.body.style.cursor="default",n.preventDefault()}),$(".shortcut-info").html(r)}}function u(){navigator.onLine&&sendMessage({action:"isValidToken"},function(e){e.value===!1&&sendMessage({action:"getSetting",key:"username"},function(e){e.value!==""&&sendMessage({action:"logout"},function(e){t()})})})}var e=["twitter","greader","hackernews","reddit","keyboard-shortcut"];addMessageListener(function(e,n,r){e.action==="updateOptions"&&t()}),window.onload=s})();