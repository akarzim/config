var EXPORTED_SYMBOLS=["BadgeManager"];Components.utils["import"]("resource://dntp/ff/overlay.js");
var BadgeManager={badges:{totalBlocked:{levels:[{name:"dntp.badges.bronze",limit:500,cssClass:"Bronze",icon:"/badge/bronze.png"},{name:"dntp.badges.silver",limit:5E3,cssClass:"Silver",icon:"/badge/silver.png"},{name:"dntp.badges.gold",limit:1E4,cssClass:"Gold",icon:"/badge/gold.png"},{name:"dntp.badges.platinum",cssClass:"Platinum",limit:25E3,icon:"/badge/platinum.png",level:1}],text:"dntp.badges.totalBlocked.text",title:"dntp.badges.totalBlocked.title",badgeText:"dntp.badges.totalBlocked.badgeText"},
socialBlocked:{levels:[{name:"dntp.badges.bronze",limit:100,cssClass:"Bronze",icon:"/badge/bronze.png"},{name:"dntp.badges.silver",limit:1E3,cssClass:"Silver",icon:"/badge/silver.png"},{name:"dntp.badges.gold",limit:5E3,cssClass:"Gold",icon:"/badge/gold.png"},{name:"dntp.badges.platinum",cssClass:"Platinum",limit:15E3,icon:"/badge/platinum.png",level:1}],text:"dntp.badges.socialBlocked.text",title:"dntp.badges.socialBlocked.title",badgeText:"dntp.badges.socialBlocked.badgeText"}},compute:function(a){for(var b in BadgeManager.badges){for(var c=
parseInt(DNTP.Counts[b]()),d=-1,e=parseInt(BadgeManager.getSetting(b+".badge","-1")),f=0;;){var g=BadgeManager.getBadgeAt(b,f);if(g.limit>c)break;g.limit<c&&(d=f);f++}if(d!=-1&&d!=e){BadgeManager.setSetting(b+".badge",""+d);BadgeManager.setSetting(b+".badge.viewed","no");BadgeManager.setSetting(b+".badge.earnedAt",(new Date).getTime());BadgeManager.notify(a);break}}},notify:function(a){DNTP.update_toolbar_icon(a)},mark_viewed:function(){var a=BadgeManager.getUnviewedBadge();a&&BadgeManager.setSetting(a.setting+
".badge.viewed","yes")},getUnviewedBadge:function(){for(var a in BadgeManager.badges)if(BadgeManager.getSetting(a+".badge.viewed","yes")=="no"){var b=BadgeManager.getBadgeAt(a,parseInt(BadgeManager.getSetting(a+".badge","-1")));a=DNTP.installDate-parseInt(BadgeManager.getSetting(a+".badge.earnedAt",(new Date).getTime()));b.days=parseInt(a/864E5);return b}return!1},getBadgeAt:function(a,b){var c={name:"None",limit:-1,icon:"/badge/nobadge.png"},d=BadgeManager.badges[a];if(b>=0){c=d.levels;if(b>=c.length)for(var e=
c.length-1;e<=b;e++){var f={name:c[e].name,cssClass:c[e].cssClass,limit:c[e].limit+(a.indexOf("social")==0?1E4:25E3),icon:c[e].icon,level:c[e].level+1};c.push(f)}c=c[b]}c.title=d.title;c.text=d.text;c.badgeText=d.badgeText;c.setting=a;return c},getBadges:function(){var a=[],b;for(b in BadgeManager.badges){var c=parseInt(BadgeManager.getSetting(b+".badge","-1")),d=BadgeManager.getBadgeAt(b,c);d.nextBadge=BadgeManager.getBadgeAt(b,c+1);a.push(d)}return a},setSetting:function(a,b){DNTP.Config.set(a,
b)},getSetting:function(a,b){return DNTP.Config.get(a,b)}};DNTP.BadgeManager=BadgeManager;